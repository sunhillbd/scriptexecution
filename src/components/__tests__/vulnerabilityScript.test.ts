import { describe, it, expect } from 'vitest';
import { getExecutionOrder, VulnerabilityScript } from '../../vulnerabilityScript';

describe('getExecutionOrder', () => {
  it('should return the correct execution order', () => {
    const script1 = new VulnerabilityScript(1, []);
    const script2 = new VulnerabilityScript(2, [1]);
    const script3 = new VulnerabilityScript(3, [2]);
    const script4 = new VulnerabilityScript(4, [2, 3]);

    const scripts = [script4, script3, script2, script1];
    const order = getExecutionOrder(scripts);

    expect(order).toEqual([1, 2, 3, 4]);
  });

  it('should handle scripts with no dependencies', () => {
    const script1 = new VulnerabilityScript(1, []);
    const script2 = new VulnerabilityScript(2, []);

    const scripts = [script1, script2];
    const order = getExecutionOrder(scripts);

    expect(order).toEqual([1, 2]);
  });

  it('should throw an error for circular dependencies', () => {
    const script1 = new VulnerabilityScript(1, [2]);
    const script2 = new VulnerabilityScript(2, [1]);

    const scripts = [script1, script2];

    expect(() => getExecutionOrder(scripts)).toThrow(Error);
  });
});
